{% extends "reports/reports_base.html" %}

{% block custom-head %}
<script type="text/javascript" src="/site_media/js/jquery-2.0.3.min.js"></script>

<style type="text/css">
      #map-container {
        padding: 6px;
        border-width: 1px;
        border-style: solid;
        border-color: #ccc #ccc #999 #ccc;
        -webkit-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        -moz-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        box-shadow: rgba(64, 64, 64, 0.1) 0 2px 5px;
        width: 1200px;
      }

      #map {
        width: 1200px;
        height: 600px;
      }[]
</style>

<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
	var script = '<script type="text/javascript" src="/site_media/js/markerclusterer';
	if (document.location.search.indexOf('compiled') !== -1) {
		script += '_compiled';
	}
	script += '.js"><' + '/script>';
	document.write(script);
</script>

    <script type="text/javascript">
		function initialize() {
			var center = new google.maps.LatLng(30.9, 21.2);

			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 2,
				center: center,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});

			var markers = [];

			$.ajax({
				url: '/reports/visa/map/json/',
				async: false,
				success: function ( visas ) {

						$.each( visas, function ( key, val ) {
							var latLng = new google.maps.LatLng(parseFloat(val.latitude), parseFloat(val.longitude));
							var marker = new google.maps.Marker({
								position: latLng
							});

        				markers.push(marker);

						});

					},
				failure: function (data) {
					alert(data);
					}
			});

			var markerCluster = new MarkerClusterer(map, markers);
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
{% endblock %}

{% block content %}
<h3>Visa Report</h3>
<p><a href="/reports/visa/">Back to Reports View</a></p>


<div id="map-container"><div id="map"></div></div>
{% endblock %}